<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deutsch Lernen ‚Äî Trilingual</title>
<meta name="theme-color" content="#0ea5e9">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Crect width='256' height='256' rx='48' fill='%230ea5e9'/%3E%3Ctext x='128' y='156' font-size='120' text-anchor='middle' fill='white' font-family='Arial, sans-serif'%3EDE%3C/text%3E%3C/svg%3E">
<style>
:root{
  --primary:#0ea5e9; --primary-dark:#0284c7; --success:#22c55e; --danger:#ef4444; --muted:#93a3b8;
  --bg:#0b1020; --surface:#0f172a; --card:#101827; --text:#e5e7eb; --border:#1f2a3a;
  --r:14px; --shadow:0 10px 30px rgba(0,0,0,.25);
}
*{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0b1020,#0b1020 40%,#0d1326);color:var(--text)}
header{position:sticky;top:0;z-index:10;background:linear-gradient(135deg,var(--primary),var(--primary-dark));box-shadow:var(--shadow);padding:10px 12px}
h1{margin:4px 0;text-align:center;font-weight:800}
nav{display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap}
nav ul{margin:0;padding:0;list-style:none;display:flex;justify-content:center;gap:6px;flex-wrap:wrap}
nav a{color:white;text-decoration:none;padding:8px 12px;border-radius:999px}
nav a.active, nav a:hover{background:rgba(255,255,255,.18)}
.lang-wrap{margin-left:8px;display:flex;align-items:center;gap:6px}
.lang-wrap select{background:rgba(0,0,0,.2);color:#fff;border:1px solid rgba(255,255,255,.3);border-radius:8px;padding:6px 8px}
main{max-width:1100px;margin:0 auto;padding:16px;min-height:calc(100vh - 140px)}
h2{color:#7dd3fc;margin:6px 0 14px}
.tab-content{display:none;animation:fade .25s ease-in} .tab-content.active{display:block}
@keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);padding:16px;margin:12px 0}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button{background:var(--primary);color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;transition:.2s}
button.ghost{background:#0b1222;border:1px solid var(--border);color:#cbd5e1}
button:hover{filter:brightness(.96);transform:translateY(-1px)}
select,input[type="search"]{width:100%;padding:10px 12px;border-radius:10px;border:2px solid var(--border);background:#0b1222;color:#e5e7eb}
label{color:#93c5fd;font-size:.95rem}
.badge{background:#0b1222;border:1px solid var(--border);padding:4px 8px;border-radius:999px;color:#93c5fd}
.item{display:flex;justify-content:space-between;gap:10px;align-items:center}
.item strong{color:#7dd3fc}
.muted{color:var(--muted)}
/* Quiz */
#progress{height:8px;background:#0b1222;border-radius:999px;overflow:hidden}
#bar{height:100%;width:0;background:linear-gradient(90deg,var(--primary),var(--success))}
.opt{padding:12px;border:2px solid var(--border);border-radius:12px;margin:8px 0;background:#0b1222;cursor:pointer;font-weight:600}
.opt.correct{background:var(--success);border-color:var(--success);color:#04110a}
.opt.wrong{background:var(--danger);border-color:var(--danger);color:#fff}
.opt.dis{pointer-events:none;opacity:.85}
/* Flip cards (fixed mirroring via backface-visibility) */
#flipWrap{display:flex;justify-content:center;margin:16px 0}
#flip{width:340px;max-width:100%;height:210px;perspective:1000px}
#flip .inner{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform .6s}
#flip.flipped .inner{transform:rotateY(180deg)}
.face{position:absolute;inset:0;border:2px solid var(--border);border-radius:16px;background:#0b1222;display:flex;align-items:center;justify-content:center;text-align:center;padding:18px;box-shadow:var(--shadow);
  -webkit-backface-visibility:hidden; backface-visibility:hidden;}
.back{transform:rotateY(180deg);background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#04110a;font-weight:800;
  -webkit-backface-visibility:hidden; backface-visibility:hidden;}
#counter{min-width:72px;text-align:center;color:#93c5fd}
.dlg-bubble{padding:10px 12px;border-radius:12px;margin:6px 0;max-width:90%}
.dlg-de{background:#102030;border:1px solid #1f2937}
.dlg-ru{font-size:.9rem;color:#9ca3af;margin-top:4px}
@media (max-width:420px){nav a{padding:6px 8px} h1{font-size:18px}}
</style>
</head>
<body>
<header>
  <h1 id="ui-title">Deutsch Lernen</h1>
  <nav>
    <ul id="tabs">
      <li><a href="#lessons" data-tab="lessons" class="active" id="nav-lessons">–£—Ä–æ–∫–∏</a></li>
      <li><a href="#dictionary" data-tab="dictionary" id="nav-dict">–°–ª–æ–≤–∞—Ä—å</a></li>
      <li><a href="#test" data-tab="test" id="nav-test">–¢–µ—Å—Ç</a></li>
      <li><a href="#grammar" data-tab="grammar" id="nav-gram">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</a></li>
      <li><a href="#cards" data-tab="cards" id="nav-cards">–ö–∞—Ä—Ç–æ—á–∫–∏</a></li>
      <li><a href="#dialogs" data-tab="dialogs" id="nav-dialogs">–î–∏–∞–ª–æ–≥–∏</a></li>
    </ul>
    <div class="lang-wrap">
      <label for="ui-lang" id="ui-lang-label">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
      <select id="ui-lang">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="az">Az…ôrbaycanca</option>
        <option value="de">Deutsch</option>
      </select>
      <label for="trans-lang" id="trans-lang-label">–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞</label>
      <select id="trans-lang">
        <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="az">Az…ôrbaycanca</option>
      </select>
    </div>
  </nav>
</header>

<main>
  <!-- LESSONS -->
  <section id="lessons" class="tab-content active">
    <h2 id="h-lessons">–£—Ä–æ–∫–∏</h2>
    <div class="card">
      <div class="row">
        <div style="flex:1">
          <label for="lesson-filter" id="label-lesson-topic">–¢–µ–º–∞ —É—Ä–æ–∫–æ–≤</label>
          <select id="lesson-filter"></select>
        </div>
        <div><span class="badge" id="lesson-count"></span></div>
      </div>
    </div>
    <div id="lessons-list"></div>
  </section>

  <!-- DICTIONARY -->
  <section id="dictionary" class="tab-content">
    <h2 id="h-dict">–°–ª–æ–≤–∞—Ä—å</h2>
    <div class="card">
      <div class="row">
        <div style="flex:2">
          <label id="label-search">–ü–æ–∏—Å–∫</label>
          <input id="q" type="search" placeholder="–ù–∞–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ –ø–æ-–Ω–µ–º–µ—Ü–∫–∏ –∏–ª–∏ –ø–æ-—Ä—É—Å—Å–∫–∏‚Ä¶">
        </div>
        <div style="flex:1">
          <label for="topic" id="label-topic">–¢–µ–º–∞</label>
          <select id="topic"></select>
        </div>
        <div style="display:flex;gap:8px;align-items:flex-end">
          <button id="onlyFav" class="ghost">–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
          <button id="exportBtn" class="ghost">–≠–∫—Å–ø–æ—Ä—Ç</button>
          <label for="importFile" class="ghost" style="display:inline-block;padding:10px 14px;cursor:pointer" id="btn-import">–ò–º–ø–æ—Ä—Ç</label>
          <input id="importFile" type="file" accept="application/json" style="display:none">
        </div>
      </div>
    </div>
    <div id="dict"></div>
  </section>

  <!-- TEST -->
  <section id="test" class="tab-content">
    <h2 id="h-test">–¢–µ—Å—Ç</h2>
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div id="progText" class="badge">0 / 30</div>
        <div style="flex:1"></div>
      </div>
      <div id="progress"><div id="bar"></div></div>
      <div id="question" style="font-size:18px;font-weight:800;margin:14px 0"></div>
      <div id="options"></div>
      <div id="final" style="display:none;text-align:center;margin-top:10px">
        <div id="scoreText" style="font-size:20px;margin:8px 0 12px"></div>
        <button id="again" class="ghost">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç</button>
      </div>
    </div>
  </section>

  <!-- GRAMMAR -->
  <section id="grammar" class="tab-content">
    <h2 id="h-gram">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</h2>
    <div id="grammar-list"></div>
  </section>

  <!-- CARDS -->
  <section id="cards" class="tab-content">
    <h2 id="h-cards">–ö–∞—Ä—Ç–æ—á–∫–∏</h2>
    <div class="card">
      <div class="row">
        <div style="flex:1">
          <label for="cards-topic" id="label-cards-topic">–¢–µ–º–∞ –∫–∞—Ä—Ç–æ—á–µ–∫</label>
          <select id="cards-topic"></select>
        </div>
        <div style="display:flex;gap:8px;align-items:flex-end">
          <button id="cards-only-fav" class="ghost">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
          <button id="say" class="ghost">üîä –û–∑–≤—É—á–∏—Ç—å</button>
        </div>
      </div>
    </div>
    <div id="flipWrap">
      <div id="flip">
        <div class="inner">
          <div class="face front"><div id="frontText"></div></div>
          <div class="face back"><div id="backText"></div></div>
        </div>
      </div>
    </div>
    <div class="row" style="justify-content:center">
      <button id="prev" class="ghost">‚óÄ</button>
      <div id="counter">1 / 1</div>
      <button id="next" class="ghost">‚ñ∂</button>
      <button id="flipBtn">–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å</button>
    </div>
  </section>

  <!-- DIALOGS -->
  <section id="dialogs" class="tab-content">
    <h2 id="h-dialogs">–î–∏–∞–ª–æ–≥–∏ (–ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–µ —Ç–µ–º—ã)</h2>
    <div class="card">
      <div class="row">
        <div style="flex:1">
          <label for="dlg-topic" id="label-dlg-topic">–¢–µ–º–∞</label>
          <select id="dlg-topic"></select>
        </div>
        <div style="display:flex;gap:8px;align-items:flex-end">
          <button id="playdlg" class="ghost">üîä –û–∑–≤—É—á–∏—Ç—å (DE)</button>
        </div>
      </div>
    </div>
    <div id="dlg-box" class="card" style="display:flex;flex-direction:column"></div>
  </section>
</main>

<script>
// =================== UI TEXTS (RU/AZ/DE) ===================
const UI = {
  ru:{ title:"Deutsch Lernen",
    nav:{lessons:"–£—Ä–æ–∫–∏",dict:"–°–ª–æ–≤–∞—Ä—å",test:"–¢–µ—Å—Ç",gram:"–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞",cards:"–ö–∞—Ä—Ç–æ—á–∫–∏",dialogs:"–î–∏–∞–ª–æ–≥–∏"},
    labels:{
      uiLang:"–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞", transLang:"–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞",
      lessonTopic:"–¢–µ–º–∞ —É—Ä–æ–∫–æ–≤", lessons:"–£—Ä–æ–∫–∏",
      search:"–ü–æ–∏—Å–∫", topic:"–¢–µ–º–∞", onlyFav:"–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ", export:"–≠–∫—Å–ø–æ—Ä—Ç", import:"–ò–º–ø–æ—Ä—Ç",
      test:"–¢–µ—Å—Ç", again:"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç",
      grammar:"–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞",
      cards:"–ö–∞—Ä—Ç–æ—á–∫–∏", cardsTopic:"–¢–µ–º–∞ –∫–∞—Ä—Ç–æ—á–µ–∫", fav:"–ò–∑–±—Ä–∞–Ω–Ω–æ–µ", speak:"üîä –û–∑–≤—É—á–∏—Ç—å", flip:"–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å",
      dialogs:"–î–∏–∞–ª–æ–≥–∏ (–ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–µ —Ç–µ–º—ã)", dlgTopic:"–¢–µ–º–∞", playDlg:"üîä –û–∑–≤—É—á–∏—Ç—å (DE)"
    }
  },
  az:{ title:"Deutsch Lernen",
    nav:{lessons:"D…ôrsl…ôr",dict:"L√ºƒü…ôt",test:"Test",gram:"Qrammatika",cards:"Kartlar",dialogs:"Dialoqlar"},
    labels:{
      uiLang:"ƒ∞nterfeys dili", transLang:"T…ôrc√ºm…ô dili",
      lessonTopic:"D…ôrs m√∂vzusu", lessons:"D…ôrsl…ôr",
      search:"Axtarƒ±≈ü", topic:"M√∂vzu", onlyFav:"Yalnƒ±z sevimlil…ôr", export:"ƒ∞xrac", import:"ƒ∞dxal",
      test:"Test", again:"T…ôkrar et",
      grammar:"Qrammatika",
      cards:"Kartlar", cardsTopic:"Kart m√∂vzusu", fav:"Sevimlil…ôr", speak:"üîä S…ôsl…ôndir", flip:"√áevir",
      dialogs:"Dialoqlar (g√ºnd…ôlik m√∂vzular)", dlgTopic:"M√∂vzu", playDlg:"üîä S…ôsl…ôndir (DE)"
    }
  },
  de:{ title:"Deutsch Lernen",
    nav:{lessons:"Lektionen",dict:"W√∂rterbuch",test:"Test",gram:"Grammatik",cards:"Karten",dialogs:"Dialoge"},
    labels:{
      uiLang:"Oberfl√§chensprache", transLang:"√úbersetzung in",
      lessonTopic:"Thema der Lektionen", lessons:"Lektionen",
      search:"Suche", topic:"Thema", onlyFav:"Nur Favoriten", export:"Export", import:"Import",
      test:"Test", again:"Nochmal",
      grammar:"Grammatik",
      cards:"Karten", cardsTopic:"Kartenthema", fav:"Favoriten", speak:"üîä Vorlesen", flip:"Umdrehen",
      dialogs:"Dialoge (Alltag)", dlgTopic:"Thema", playDlg:"üîä Vorlesen (DE)"
    }
  }
};

let uiLang = localStorage.getItem('uiLang') || 'ru';
let transLang = localStorage.getItem('transLang') || 'ru';

function applyUI(){
  const L = UI[uiLang];
  document.getElementById('ui-title').textContent = L.title;
  document.getElementById('nav-lessons').textContent = L.nav.lessons;
  document.getElementById('nav-dict').textContent = L.nav.dict;
  document.getElementById('nav-test').textContent = L.nav.test;
  document.getElementById('nav-gram').textContent = L.nav.gram;
  document.getElementById('nav-cards').textContent = L.nav.cards;
  document.getElementById('nav-dialogs').textContent = L.nav.dialogs;
  document.getElementById('ui-lang-label').textContent = L.labels.uiLang;
  document.getElementById('trans-lang-label').textContent = L.labels.transLang;
  document.getElementById('h-lessons').textContent = L.labels.lessons;
  document.getElementById('label-lesson-topic').textContent = L.labels.lessonTopic;
  document.getElementById('h-dict').textContent = L.nav.dict;
  document.getElementById('label-search').textContent = L.labels.search;
  document.getElementById('label-topic').textContent = L.labels.topic;
  document.getElementById('onlyFav').textContent = (document.getElementById('onlyFav').dataset.on==='1') ? (L.labels.onlyFav + ' ‚úì') : L.labels.onlyFav;
  document.getElementById('exportBtn').textContent = L.labels.export;
  document.getElementById('btn-import').textContent = L.labels.import;
  document.getElementById('h-test').textContent = L.labels.test;
  document.getElementById('again').textContent = L.labels.again;
  document.getElementById('h-gram').textContent = L.labels.grammar;
  document.getElementById('h-cards').textContent = L.labels.cards;
  document.getElementById('label-cards-topic').textContent = L.labels.cardsTopic;
  document.getElementById('cards-only-fav').textContent = (document.getElementById('cards-only-fav').dataset.on==='1') ? (L.labels.fav + ' ‚úì') : L.labels.fav;
  document.getElementById('say').textContent = L.labels.speak;
  document.getElementById('flipBtn').textContent = L.labels.flip;
  document.getElementById('h-dialogs').textContent = L.labels.dialogs;
  document.getElementById('label-dlg-topic').textContent = L.labels.dlgTopic;
  document.getElementById('playdlg').textContent = L.labels.playDlg;
  // placeholders
  document.getElementById('q').placeholder = (uiLang==='de') ? "Wort auf Deutsch oder √úbersetzung eingeben‚Ä¶" : (uiLang==='az' ? "Alman v…ô ya t…ôrc√ºm…ô s√∂z√ºn√º yazƒ±n‚Ä¶" : "–ù–∞–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ –ø–æ-–Ω–µ–º–µ—Ü–∫–∏ –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥‚Ä¶");
}

// =================== –î–ê–ù–ù–´–ï ===================
const TOPICS = [
  "–û—Å–Ω–æ–≤—ã","–ß–∏—Å–ª–∞","–¶–≤–µ—Ç–∞","–°–µ–º—å—è","–î–æ–º","–ï–¥–∞","–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è","–ü–æ–∫—É–ø–∫–∏","–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
  "–†–∞–±–æ—Ç–∞ –∏ —É—á—ë–±–∞","–í—Ä–µ–º—è –∏ –ø–æ–≥–æ–¥–∞","–ó–¥–æ—Ä–æ–≤—å–µ","–ì–æ—Ä–æ–¥","–°–≤—è–∑—å","–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–µ–ª–∞"
];

// –°–ª–æ–≤–∞—Ä—å —Å —Ç—Ä–æ–π–Ω—ã–º–∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ (DE + RU + AZ)
const vocabulary = [
  // –û—Å–Ω–æ–≤—ã
  {t:"–û—Å–Ω–æ–≤—ã", de:"Hallo", ru:"–ü—Ä–∏–≤–µ—Ç", az:"Salam", ipa:"Ààhalo"},
  {t:"–û—Å–Ω–æ–≤—ã", de:"Guten Tag", ru:"–î–æ–±—Ä—ã–π –¥–µ–Ω—å", az:"G√ºnorta salamƒ±", ipa:"Àå…°uÀêtnÃ© ÀàtaÀêk"},
  {t:"–û—Å–Ω–æ–≤—ã", de:"Danke", ru:"–°–ø–∞—Å–∏–±–æ", az:"T…ô≈ü…ôkk√ºrl…ôr", ipa:"Ààda≈ãk…ô"},
  {t:"–û—Å–Ω–æ–≤—ã", de:"Bitte", ru:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ (–ø–æ–∂–∞–ª—É–π—Å—Ç–∞/–≤ –æ—Ç–≤–µ—Ç)", az:"Buyurun / Z…ôhm…ôt olmasa", ipa:"Ààb…™t…ô"},
  {t:"–û—Å–Ω–æ–≤—ã", de:"Entschuldigung", ru:"–ò–∑–≤–∏–Ω–∏—Ç–µ", az:"Baƒüƒ±≈ülayƒ±n", ipa:"…õntÀà É äld…™…° ä≈ã"},
  {t:"–û—Å–Ω–æ–≤—ã", de:"Wie hei√üen Sie?", ru:"–ö–∞–∫ –í–∞—Å –∑–æ–≤—É—Ç?", az:"Adƒ±nƒ±z n…ôdir?", ipa:"viÀê Ààha…™ÃØs…ôn ziÀê"},
  {t:"–û—Å–Ω–æ–≤—ã", de:"Ich hei√üe ‚Ä¶", ru:"–ú–µ–Ω—è –∑–æ–≤—É—Ç ‚Ä¶", az:"M…ônim adƒ±m ‚Ä¶", ipa:"…™√ß Ààha…™ÃØs…ô"},
  {t:"–û—Å–Ω–æ–≤—ã", de:"Wie geht's?", ru:"–ö–∞–∫ –¥–µ–ª–∞?", az:"Nec…ôsiniz?", ipa:"viÀê Àà…°eÀêts"},
  {t:"–û—Å–Ω–æ–≤—ã", de:"Auf Wiedersehen!", ru:"–î–æ —Å–≤–∏–¥–∞–Ω–∏—è!", az:"Saƒü olun / H…ôl…ôlik!", ipa:"a äÃØf ÀàviÀêd…êÀåzeÀê…ôn"},
  // –ß–∏—Å–ª–∞
  {t:"–ß–∏—Å–ª–∞", de:"eins", ru:"–æ–¥–∏–Ω", az:"bir", ipa:"a…™ÃØns"},
  {t:"–ß–∏—Å–ª–∞", de:"zwei", ru:"–¥–≤–∞", az:"iki", ipa:"tÕ°sva…™ÃØ"},
  {t:"–ß–∏—Å–ª–∞", de:"drei", ru:"—Ç—Ä–∏", az:"√º√ß", ipa:"d Åa…™ÃØ"},
  {t:"–ß–∏—Å–ª–∞", de:"vier", ru:"—á–µ—Ç—ã—Ä–µ", az:"d√∂rd", ipa:"fiÀê…êÃØ"},
  {t:"–ß–∏—Å–ª–∞", de:"f√ºnf", ru:"–ø—è—Ç—å", az:"be≈ü", ipa:"f ènf"},
  {t:"–ß–∏—Å–ª–∞", de:"sechs", ru:"—à–µ—Å—Ç—å", az:"altƒ±", ipa:"z…õks"},
  {t:"–ß–∏—Å–ª–∞", de:"sieben", ru:"—Å–µ–º—å", az:"yeddi", ipa:"ÀàziÀêbnÃ©"},
  {t:"–ß–∏—Å–ª–∞", de:"acht", ru:"–≤–æ—Å–µ–º—å", az:"s…ôkkiz", ipa:"axt"},
  {t:"–ß–∏—Å–ª–∞", de:"neun", ru:"–¥–µ–≤—è—Ç—å", az:"doqquz", ipa:"n…î èÃØn"},
  {t:"–ß–∏—Å–ª–∞", de:"zehn", ru:"–¥–µ—Å—è—Ç—å", az:"on", ipa:"tseÀên"},
  // –¶–≤–µ—Ç–∞
  {t:"–¶–≤–µ—Ç–∞", de:"rot", ru:"–∫—Ä–∞—Å–Ω—ã–π", az:"qƒ±rmƒ±zƒ±", ipa:" ÅoÀêt"},
  {t:"–¶–≤–µ—Ç–∞", de:"blau", ru:"—Å–∏–Ω–∏–π", az:"g√∂y", ipa:"bla äÃØ"},
  {t:"–¶–≤–µ—Ç–∞", de:"gr√ºn", ru:"–∑–µ–ª—ë–Ω—ã–π", az:"ya≈üƒ±l", ipa:"…° ÅyÀên"},
  {t:"–¶–≤–µ—Ç–∞", de:"gelb", ru:"–∂—ë–ª—Ç—ã–π", az:"sarƒ±", ipa:"…°…õlp"},
  {t:"–¶–≤–µ—Ç–∞", de:"schwarz", ru:"—á—ë—Ä–Ω—ã–π", az:"qara", ipa:" Éva Åts"},
  {t:"–¶–≤–µ—Ç–∞", de:"wei√ü", ru:"–±–µ–ª—ã–π", az:"aƒü", ipa:"va…™ÃØs"},
  // –°–µ–º—å—è
  {t:"–°–µ–º—å—è", de:"die Familie", ru:"—Å–µ–º—å—è", az:"ail…ô", ipa:"diÀê faÀàmiÀêliÃØ…ô"},
  {t:"–°–µ–º—å—è", de:"der Vater", ru:"–æ—Ç–µ—Ü", az:"ata", ipa:"deÀê…êÃØ ÀàfaÀêt…ê"},
  {t:"–°–µ–º—å—è", de:"die Mutter", ru:"–º–∞—Ç—å", az:"ana", ipa:"diÀê Ààm ät…ê"},
  {t:"–°–µ–º—å—è", de:"der Sohn", ru:"—Å—ã–Ω", az:"oƒüul", ipa:"zoÀên"},
  {t:"–°–µ–º—å—è", de:"die Tochter", ru:"–¥–æ—á—å", az:"qƒ±z √∂vladƒ±", ipa:"Ààt…îxt…ê"},
  {t:"–°–µ–º—å—è", de:"der Bruder", ru:"–±—Ä–∞—Ç", az:"qarda≈ü", ipa:"Ààb ÅuÀêd…ê"},
  {t:"–°–µ–º—å—è", de:"die Schwester", ru:"—Å–µ—Å—Ç—Ä–∞", az:"bacƒ±", ipa:"Àà Év…õst…ê"},
  // –î–æ–º
  {t:"–î–æ–º", de:"das Haus", ru:"–¥–æ–º", az:"ev", ipa:"ha äÃØs"},
  {t:"–î–æ–º", de:"die Wohnung", ru:"–∫–≤–∞—Ä—Ç–∏—Ä–∞", az:"m…ônzil", ipa:"ÀàvoÀên ä≈ã"},
  {t:"–î–æ–º", de:"das Zimmer", ru:"–∫–æ–º–Ω–∞—Ç–∞", az:"otaq", ipa:"Ààts…™m…ê"},
  {t:"–î–æ–º", de:"die K√ºche", ru:"–∫—É—Ö–Ω—è", az:"m…ôtb…ôx", ipa:"Ààk è√ß…ô"},
  {t:"–î–æ–º", de:"das Badezimmer", ru:"–≤–∞–Ω–Ω–∞—è", az:"hamam otaƒüƒ±", ipa:"ÀàbaÀêd…ôts…™m…ê"},
  // –ï–¥–∞
  {t:"–ï–¥–∞", de:"das Brot", ru:"—Ö–ª–µ–±", az:"√ß√∂r…ôk", ipa:"b ÅoÀêt"},
  {t:"–ï–¥–∞", de:"die Milch", ru:"–º–æ–ª–æ–∫–æ", az:"s√ºd", ipa:"m…™l√ß"},
  {t:"–ï–¥–∞", de:"das Wasser", ru:"–≤–æ–¥–∞", az:"su", ipa:"Ààvas…ê"},
  {t:"–ï–¥–∞", de:"der Kaffee", ru:"–∫–æ—Ñ–µ", az:"q…ôhv…ô", ipa:"Ààkafe"},
  {t:"–ï–¥–∞", de:"der Tee", ru:"—á–∞–π", az:"√ßay", ipa:"teÀê"},
  {t:"–ï–¥–∞", de:"die Rechnung, bitte", ru:"–°—á—ë—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞", az:"Hesab, z…ôhm…ôt olmasa", ipa:"Àà Å…õ√ßn ä≈ã"},
  // –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
  {t:"–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", de:"der Bahnhof", ru:"–≤–æ–∫–∑–∞–ª", az:"d…ômir yolu vaƒüzalƒ±", ipa:"ÀàbaÀênhoÀêf"},
  {t:"–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", de:"der Flughafen", ru:"–∞—ç—Ä–æ–ø–æ—Ä—Ç", az:"hava limanƒ±", ipa:"ÀàfluÀêkÀåhaÀêfnÃ©"},
  {t:"–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", de:"das Ticket", ru:"–±–∏–ª–µ—Ç", az:"bilet", ipa:"Ààt…™k…ôt"},
  {t:"–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", de:"Wo ist die Haltestelle?", ru:"–ì–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞?", az:"Dayanacaq haradadƒ±r?", ipa:""},
  // –ü–æ–∫—É–ø–∫–∏
  {t:"–ü–æ–∫—É–ø–∫–∏", de:"der Preis", ru:"—Ü–µ–Ω–∞", az:"qiym…ôt", ipa:"p Åa…™ÃØs"},
  {t:"–ü–æ–∫—É–ø–∫–∏", de:"Wie viel kostet das?", ru:"–°–∫–æ–ª—å–∫–æ —ç—Ç–æ —Å—Ç–æ–∏—Ç?", az:"Bu ne√ß…ôy…ôdir?", ipa:""},
  {t:"–ü–æ–∫—É–ø–∫–∏", de:"bar / mit Karte", ru:"–Ω–∞–ª–∏—á–Ω—ã–º–∏ / –∫–∞—Ä—Ç–æ–π", az:"naƒüd / kartla", ipa:""},
  {t:"–ü–æ–∫—É–ø–∫–∏", de:"die Gr√∂√üe", ru:"—Ä–∞–∑–º–µ—Ä (–æ–¥–µ–∂–¥—ã)", az:"√∂l√ß√º", ipa:"Àà…° Å√∏Àês…ô"},
  // –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
  {t:"–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", de:"die U-Bahn", ru:"–º–µ—Ç—Ä–æ", az:"metro", ipa:""},
  {t:"–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", de:"F√§hrt dieser Zug nach ‚Ä¶?", ru:"–≠—Ç–æ—Ç –ø–æ–µ–∑–¥ –∏–¥—ë—Ç –¥–æ ‚Ä¶?", az:"Bu qatar ‚Ä¶ gedirmi?", ipa:""},
  // –†–∞–±–æ—Ç–∞ –∏ —É—á—ë–±–∞
  {t:"–†–∞–±–æ—Ç–∞ –∏ —É—á—ë–±–∞", de:"der Beruf", ru:"–ø—Ä–æ—Ñ–µ—Å—Å–∏—è", az:"pe≈ü…ô", ipa:"b…ôÀà ÅuÀêf"},
  {t:"–†–∞–±–æ—Ç–∞ –∏ —É—á—ë–±–∞", de:"der Lehrer / die Lehrerin", ru:"—É—á–∏—Ç–µ–ª—å / —É—á–∏—Ç–µ–ª—å–Ω–∏—Ü–∞", az:"m√º…ôllim / m√º…ôllim…ô", ipa:""},
  {t:"–†–∞–±–æ—Ç–∞ –∏ —É—á—ë–±–∞", de:"die Pr√ºfung", ru:"—ç–∫–∑–∞–º–µ–Ω", az:"imtahan", ipa:"Ààp ÅyÀêf ä≈ã"},
  // –í—Ä–µ–º—è –∏ –ø–æ–≥–æ–¥–∞
  {t:"–í—Ä–µ–º—è –∏ –ø–æ–≥–æ–¥–∞", de:"heute / gestern / morgen", ru:"—Å–µ–≥–æ–¥–Ω—è / –≤—á–µ—Ä–∞ / –∑–∞–≤—Ç—Ä–∞", az:"bu g√ºn / d√ºn…ôn / sabah", ipa:""},
  {t:"–í—Ä–µ–º—è –∏ –ø–æ–≥–æ–¥–∞", de:"Es ist kalt / warm", ru:"–•–æ–ª–æ–¥–Ω–æ / —Ç–µ–ø–ª–æ", az:"Hava soyuq / isti", ipa:""},
  {t:"–í—Ä–µ–º—è –∏ –ø–æ–≥–æ–¥–∞", de:"Wie ist das Wetter?", ru:"–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞?", az:"Hava nec…ôdir?", ipa:""},
  // –ó–¥–æ—Ä–æ–≤—å–µ
  {t:"–ó–¥–æ—Ä–æ–≤—å–µ", de:"der Arzt / die √Ñrztin", ru:"–≤—Ä–∞—á (–º/–∂)", az:"h…ôkim", ipa:""},
  {t:"–ó–¥–æ—Ä–æ–≤—å–µ", de:"Ich f√ºhle mich nicht gut", ru:"–ú–Ω–µ –Ω–µ—Ö–æ—Ä–æ—à–æ", az:"√ñz√ºm√º yax≈üƒ± hiss etmir…ôm", ipa:""},
  {t:"–ó–¥–æ—Ä–æ–≤—å–µ", de:"die Apotheke", ru:"–∞–ø—Ç–µ–∫–∞", az:"apteka", ipa:""},
  // –ì–æ—Ä–æ–¥
  {t:"–ì–æ—Ä–æ–¥", de:"das Zentrum", ru:"—Ü–µ–Ω—Ç—Ä", az:"m…ôrk…ôz", ipa:""},
  {t:"–ì–æ—Ä–æ–¥", de:"die Stra√üe", ru:"—É–ª–∏—Ü–∞", az:"k√º√ß…ô", ipa:""},
  {t:"–ì–æ—Ä–æ–¥", de:"der Park", ru:"–ø–∞—Ä–∫", az:"park", ipa:""},
  {t:"–ì–æ—Ä–æ–¥", de:"Entschuldigung, wo ist ‚Ä¶?", ru:"–ò–∑–≤–∏–Ω–∏—Ç–µ, –≥–¥–µ ‚Ä¶?", az:"Baƒüƒ±≈ülayƒ±n, ‚Ä¶ haradadƒ±r?", ipa:""},
  // –°–≤—è–∑—å
  {t:"–°–≤—è–∑—å", de:"Haben Sie WLAN?", ru:"–£ –≤–∞—Å –µ—Å—Ç—å Wi‚ÄëFi?", az:"Sizd…ô Wi‚ÄëFi var?", ipa:""},
  {t:"–°–≤—è–∑—å", de:"Das funktioniert nicht", ru:"–≠—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç", az:"Bu i≈ül…ômir", ipa:""},
  // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–µ–ª–∞
  {t:"–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–µ–ª–∞", de:"aufstehen", ru:"–≤—Å—Ç–∞–≤–∞—Ç—å", az:"yuxudan durmaq", ipa:""},
  {t:"–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–µ–ª–∞", de:"einkaufen", ru:"–ø–æ–∫—É–ø–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã", az:"alƒ±≈ü-veri≈ü etm…ôk", ipa:""},
  {t:"–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –¥–µ–ª–∞", de:"kochen", ru:"–≥–æ—Ç–æ–≤–∏—Ç—å", az:"bi≈üirm…ôk", ipa:""},
];

// –£—Ä–æ–∫–∏ (—Ç–µ –∂–µ —Ç–µ–º—ã) ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–æ
const lessons = [
  { id:"basics", topic:"–û—Å–Ω–æ–≤—ã", title:"–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ",
    phrases:[
      {de:"Hallo! Wie hei√üen Sie?", ru:"–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö–∞–∫ –í–∞—Å –∑–æ–≤—É—Ç?", az:"Salam! Adƒ±nƒ±z n…ôdir?"},
      {de:"Ich hei√üe Shax. Freut mich!", ru:"–ú–µ–Ω—è –∑–æ–≤—É—Ç –®–∞–∫—Å. –ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è!", az:"M…ônim adƒ±m ≈ûaxdƒ±r. Tanƒ±≈ü olduƒüuma ≈üadam!"},
      {de:"Wie geht's?", ru:"–ö–∞–∫ –¥–µ–ª–∞?", az:"Nec…ôsiniz?"},
      {de:"Gut, danke. Und Ihnen?", ru:"–•–æ—Ä–æ—à–æ, —Å–ø–∞—Å–∏–±–æ. –ê —É –í–∞—Å?", az:"Yax≈üƒ±, saƒü olun. B…ôs siz?"},
    ],
    dialog:[
      {de:"Guten Tag! Ich hei√üe Max.", ru:"–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ú–µ–Ω—è –∑–æ–≤—É—Ç –ú–∞–∫—Å.", az:"G√ºnortanƒ±z xeyir! M…ônim adƒ±m Maksdƒ±r."},
      {de:"Wie hei√üen Sie?", ru:"–ö–∞–∫ –í–∞—Å –∑–æ–≤—É—Ç?", az:"Adƒ±nƒ±z n…ôdir?"},
      {de:"Freut mich!", ru:"–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è!", az:"Tanƒ±≈ü olmaq xo≈üdur!"}
    ]
  },
  { id:"shopping", topic:"–ü–æ–∫—É–ø–∫–∏", title:"–í –º–∞–≥–∞–∑–∏–Ω–µ –æ–¥–µ–∂–¥—ã",
    phrases:[
      {de:"Haben Sie die Jacke in Gr√∂√üe M?", ru:"–£ –≤–∞—Å –µ—Å—Ç—å –∫—É—Ä—Ç–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ M?", az:"Bu g√∂d…ôk√ß…ônin M √∂l√ß√ºs√º var?"},
      {de:"Kann ich mit Karte bezahlen?", ru:"–ú–æ–∂–Ω–æ –æ–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π?", az:"Kartla √∂d…ôy…ô bil…ôr…ôm?"},
    ],
    dialog:[
      {de:"Die Umkleidekabine ist dort.", ru:"–ü—Ä–∏–º–µ—Ä–æ—á–Ω–∞—è —Ç–∞–º.", az:"Geyinm…ô kabinasƒ± ordadƒ±r."},
      {de:"Sieht gut aus!", ru:"–í—ã–≥–ª—è–¥–∏—Ç —Ö–æ—Ä–æ—à–æ!", az:"Yax≈üƒ± g√∂r√ºn√ºr!"}
    ]
  },
  { id:"travel", topic:"–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", title:"–í –ø—É—Ç–∏",
    phrases:[
      {de:"Wo ist die Haltestelle?", ru:"–ì–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞?", az:"Dayanacaq haradadƒ±r?"},
      {de:"Ein Ticket nach Berlin, bitte.", ru:"–ë–∏–ª–µ—Ç –¥–æ –ë–µ—Ä–ª–∏–Ω–∞, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.", az:"Berlina bilet, z…ôhm…ôt olmasa."}
    ],
    dialog:[
      {de:"Einfach oder hin und zur√ºck?", ru:"–í –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É –∏–ª–∏ —Ç—É–¥–∞‚Äë–æ–±—Ä–∞—Ç–Ω–æ?", az:"T…ôk gedi≈ü, yoxsa gedi≈ü‚Äëd√∂n√º≈ü?"},
      {de:"Hin und zur√ºck, bitte.", ru:"–¢—É–¥–∞‚Äë–æ–±—Ä–∞—Ç–Ω–æ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.", az:"Gedi≈ü‚Äëd√∂n√º≈ü, z…ôhm…ôt olmasa."}
    ]
  },
  { id:"doctor", topic:"–ó–¥–æ—Ä–æ–≤—å–µ", title:"–£ –≤—Ä–∞—á–∞",
    phrases:[
      {de:"Ich f√ºhle mich nicht gut.", ru:"–ú–Ω–µ –Ω–µ—Ö–æ—Ä–æ—à–æ.", az:"√ñz√ºm√º yax≈üƒ± hiss etmir…ôm."},
      {de:"Haben Sie Schmerzen?", ru:"–£ –≤–∞—Å –µ—Å—Ç—å –±–æ–ª—å?", az:"Aƒürƒ±nƒ±z var?"},
    ],
    dialog:[
      {de:"Bitte nehmen Sie Platz.", ru:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—Å–∞–∂–∏–≤–∞–π—Ç–µ—Å—å.", az:"Z…ôhm…ôt olmasa, …ôyl…ô≈üin."},
      {de:"Wir messen die Temperatur.", ru:"–ò–∑–º–µ—Ä–∏–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É.", az:"Temperaturanƒ±zƒ± √∂l√ß…ôc…ôyik."}
    ]
  },
  { id:"cafe", topic:"–ï–¥–∞", title:"–í –∫–∞—Ñ–µ",
    phrases:[
      {de:"Ich m√∂chte einen Kaffee und ein Wasser.", ru:"–Ø —Ö–æ—á—É –∫–æ—Ñ–µ –∏ –≤–æ–¥—É.", az:"M…ôn bir q…ôhv…ô v…ô su ist…ôyir…ôm."},
      {de:"Die Rechnung, bitte.", ru:"–°—á—ë—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.", az:"Hesab, z…ôhm…ôt olmasa."},
    ],
    dialog:[
      {de:"Kommt sofort!", ru:"–°–µ–π—á–∞—Å –ø—Ä–∏–Ω–µ—Å—É!", az:"ƒ∞ndic…ô g…ôtirir…ôm!"},
      {de:"Guten Appetit!", ru:"–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!", az:"Nu≈ü olsun!"}
    ]
  }
];

// –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞
const grammar = [
  { title:"–ê—Ä—Ç–∏–∫–ª–∏ (der, die, das) –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ",
    points:[
      "der ‚Äî –º—É–∂—Å–∫–æ–π; die ‚Äî –∂–µ–Ω—Å–∫–∏–π; das ‚Äî —Å—Ä–µ–¥–Ω–∏–π —Ä–æ–¥.",
      "Nicht bestimmt: ein (m/n), eine (f).",
      "Plural –æ–±—ã—á–Ω–æ —Å –∞—Ä—Ç–∏–∫–ª–µ–º die."
    ],
    examples:[
      {de:"der Mann ‚Äî die M√§nner", ru:"–º—É–∂—á–∏–Ω–∞ ‚Äî –º—É–∂—á–∏–Ω—ã", az:"ki≈üi ‚Äî ki≈üil…ôr"},
      {de:"die Frau ‚Äî die Frauen", ru:"–∂–µ–Ω—â–∏–Ω–∞ ‚Äî –∂–µ–Ω—â–∏–Ω—ã", az:"qadƒ±n ‚Äî qadƒ±nlar"},
      {de:"das Kind ‚Äî die Kinder", ru:"—Ä–µ–±—ë–Ω–æ–∫ ‚Äî –¥–µ—Ç–∏", az:"u≈üaq ‚Äî u≈üaqlar"}
    ]
  },
  { title:"–ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ (V2)",
    points:[
      "–í –ø—Ä–æ—Å—Ç–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ —Å–∫–∞–∑—É–µ–º–æ–µ –Ω–∞ –≤—Ç–æ—Ä–æ–º –º–µ—Å—Ç–µ (V2).",
      "–í –æ–±—â–µ–º –≤–æ–ø—Ä–æ—Å–µ ‚Äî –≥–ª–∞–≥–æ–ª –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ."
    ],
    examples:[
      {de:"Ich trinke Kaffee.", ru:"–Ø –ø—å—é –∫–æ—Ñ–µ.", az:"M…ôn q…ôhv…ô i√ßir…ôm."},
      {de:"Trinken Sie Kaffee?", ru:"–í—ã –ø—å—ë—Ç–µ –∫–æ—Ñ–µ?", az:"Siz q…ôhv…ô i√ßirsiniz?"}
    ]
  },
  { title:"Sein –∏ Haben (Pr√§sens)",
    points:["sein: ich bin, du bist, er/sie/es ist, wir sind, ihr seid, sie/Sie sind",
            "haben: ich habe, du hast, er/sie/es hat, wir haben, ihr habt, sie/Sie haben"],
    examples:[
      {de:"Ich bin Lehrer.", ru:"–Ø —É—á–∏—Ç–µ–ª—å.", az:"M…ôn m√º…ôllim…ôm."},
      {de:"Wir haben Zeit.", ru:"–£ –Ω–∞—Å –µ—Å—Ç—å –≤—Ä–µ–º—è.", az:"Bizim vaxtƒ±mƒ±z var."}
    ]
  }
];

// –î–∏–∞–ª–æ–≥–∏ ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ (10 —Ç–µ–º)
const dialogs = {
  "–ö–∞—Ñ–µ":[
    {de:"Was m√∂chten Sie bestellen?", ru:"–ß—Ç–æ –±—É–¥–µ—Ç–µ –∑–∞–∫–∞–∑—ã–≤–∞—Ç—å?", az:"N…ô sifari≈ü etm…ôk ist…ôyirsiniz?"},
    {de:"Einen Cappuccino und ein Wasser, bitte.", ru:"–ö–∞–ø—É—á–∏–Ω–æ –∏ –≤–æ–¥—É, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.", az:"Bir kapu√ßino v…ô su, z…ôhm…ôt olmasa."},
    {de:"Noch etwas?", ru:"–ï—â—ë —á—Ç–æ‚Äë–Ω–∏–±—É–¥—å?", az:"Ba≈üqa n…ô is…ô?"},
    {de:"Das ist alles. Danke!", ru:"–≠—Ç–æ –≤—Å—ë. –°–ø–∞—Å–∏–±–æ!", az:"Bu q…ôd…ôr. T…ô≈ü…ôkk√ºrl…ôr!"}
  ],
  "–û—Ç–µ–ª—å":[
    {de:"Ich habe eine Reservierung auf den Namen Shax.", ru:"–£ –º–µ–Ω—è –±—Ä–æ–Ω—å –Ω–∞ –∏–º—è –®–∞–∫—Å.", az:"≈ûax adƒ±na rezervasiyam var."},
    {de:"Ihr Zimmer ist im dritten Stock.", ru:"–í–∞—à –Ω–æ–º–µ—Ä –Ω–∞ —Ç—Ä–µ—Ç—å–µ–º —ç—Ç–∞–∂–µ.", az:"Sizin otaƒüƒ±nƒ±z √º√ß√ºnc√º m…ôrt…ôb…ôd…ôdir."},
    {de:"Hier ist die Schl√ºsselkarte.", ru:"–í–æ—Ç –∫–ª—é—á‚Äë–∫–∞—Ä—Ç–∞.", az:"Buyurun, a√ßar kartƒ±nƒ±z."}
  ],
  "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç":[
    {de:"F√§hrt dieser Bus zum Zentrum?", ru:"–≠—Ç–æ—Ç –∞–≤—Ç–æ–±—É—Å –∏–¥—ë—Ç –≤ —Ü–µ–Ω—Ç—Ä?", az:"Bu avtobus m…ôrk…ôz…ô gedir?"},
    {de:"Ja, steigen Sie bitte ein.", ru:"–î–∞, –∑–∞—Ö–æ–¥–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.", az:"B…ôli, buyurun, minin."}
  ],
  "–ë–∞–Ω–∫":[
    {de:"Ich m√∂chte ein Konto er√∂ffnen.", ru:"–Ø —Ö–æ—á—É –æ—Ç–∫—Ä—ã—Ç—å —Å—á—ë—Ç.", az:"Hesab a√ßmaq ist…ôyir…ôm."},
    {de:"Haben Sie Ihren Ausweis dabei?", ru:"–£ –≤–∞—Å –µ—Å—Ç—å —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏?", az:"≈û…ôxsiyy…ôt v…ôsiq…ôniz yanƒ±nƒ±zdadƒ±r?"}
  ],
  "–ü–æ—á—Ç–∞":[
    {de:"Ich m√∂chte ein Paket schicken.", ru:"–•–æ—á—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É.", az:"Bir baƒülama g√∂nd…ôrm…ôk ist…ôyir…ôm."},
    {de:"Wohin geht das Paket?", ru:"–ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—ã–ª–∫–∞?", az:"Baƒülama hara g√∂nd…ôrilir?"}
  ],
  "–ê—Ä–µ–Ω–¥–∞":[
    {de:"Gibt es eine Zwei‚ÄëZimmer‚ÄëWohnung?", ru:"–ï—Å—Ç—å –¥–≤—É—Ö–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞?", az:"ƒ∞ki otaqlƒ± m…ônzil varmƒ±?"},
    {de:"Die Miete betr√§gt 800 Euro.", ru:"–ê—Ä–µ–Ω–¥–∞ ‚Äî 800 –µ–≤—Ä–æ.", az:"Kiray…ô 800 avrodur."}
  ],
  "–°—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç":[
    {de:"Wo finde ich die Milch?", ru:"–ì–¥–µ –Ω–∞–π—Ç–∏ –º–æ–ª–æ–∫–æ?", az:"S√ºd√º harada tapa bil…ôr…ôm?"},
    {de:"Im K√ºhlregal links.", ru:"–í —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ —Å–ª–µ–≤–∞.", az:"Soldakƒ± soyuducudadƒ±r."}
  ],
  "–ò–Ω—Ç–µ—Ä–≤—å—é":[
    {de:"Erz√§hlen Sie kurz √ºber sich.", ru:"–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–æ –æ —Å–µ–±–µ.", az:"√ñz√ºn√ºz haqqƒ±nda qƒ±saca danƒ±≈üƒ±n."},
    {de:"Warum m√∂chten Sie bei uns arbeiten?", ru:"–ü–æ—á–µ–º—É —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —É –Ω–∞—Å?", az:"Niy…ô bizd…ô i≈ül…ôm…ôk ist…ôyirsiniz?"}
  ],
  "–ê–ø—Ç–µ–∫–∞":[
    {de:"Haben Sie etwas gegen Kopfschmerzen?", ru:"–£ –≤–∞—Å –µ—Å—Ç—å —á—Ç–æ‚Äë–Ω–∏–±—É–¥—å –æ—Ç –≥–æ–ª–æ–≤–Ω–æ–π –±–æ–ª–∏?", az:"Ba≈ü aƒürƒ±sƒ±na qar≈üƒ± d…ôrmanƒ±nƒ±z var?"},
    {de:"Nehmen Sie die Tabletten dreimal t√§glich.", ru:"–ü—Ä–∏–Ω–∏–º–∞–π—Ç–µ —Ç–∞–±–ª–µ—Ç–∫–∏ —Ç—Ä–∏–∂–¥—ã –≤ –¥–µ–Ω—å.", az:"G√ºn …ôrzind…ô √º√ß d…ôf…ô q…ôbul edin."}
  ],
  "–ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞":[
    {de:"Ich habe heute einen Termin.", ru:"–£ –º–µ–Ω—è —Å–µ–≥–æ–¥–Ω—è –∑–∞–ø–∏—Å—å.", az:"Bu g√ºn vaxtƒ±m var (q…ôbuldayam)."},
    {de:"Warten Sie bitte im Wartezimmer.", ru:"–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤ –æ–∂–∏–¥–∞–Ω–∏–∏.", az:"Xahi≈ü edirik, g√∂zl…ôm…ô otaƒüƒ±nda g√∂zl…ôyin."}
  ]
};

// –¢–µ—Å—Ç ‚Äî 35 –≤–æ–ø—Ä–æ—Å–æ–≤ (—á–∞—Å—Ç–∏—á–Ω–æ –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
const quiz = [
  {q:"–ö–∞–∫ —Å–∫–∞–∑–∞—Ç—å ¬´–ü—Ä–∏–≤–µ—Ç¬ª?",o:["Hallo","Danke","Bitte","Tsch√ºss"],c:0},
  {q:"¬´Danke¬ª –∑–Ω–∞—á–∏—Ç‚Ä¶",o:["–ü–æ–∂–∞–ª—É–π—Å—Ç–∞","–°–ø–∞—Å–∏–±–æ","–ü–æ–∫–∞","–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ"],c:1},
  {q:"¬´Guten Abend¬ª ‚Äî —ç—Ç–æ‚Ä¶",o:["–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä","–î–æ–±—Ä–æ–π –Ω–æ—á–∏","–î–æ–±—Ä—ã–π –¥–µ–Ω—å","–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ"],c:0},
  {q:"–ß–∏—Å–ª–æ 5",o:["vier","sechs","f√ºnf","acht"],c:2},
  {q:"–¶–≤–µ—Ç ¬´–∫—Ä–∞—Å–Ω—ã–π¬ª",o:["blau","rot","gr√ºn","gelb"],c:1},
  {q:"–í–µ–∂–ª–∏–≤–æ ¬´–ö–∞–∫ –¥–µ–ª–∞?¬ª",o:["Wie geht es Ihnen?","Wie alt sind Sie?","Wo wohnen Sie?","Was ist das?"],c:0},
  {q:"¬´die Mutter¬ª ‚Äî",o:["—Å—ã–Ω","–º–∞—Ç—å","—Å–µ—Å—Ç—Ä–∞","–æ—Ç–µ—Ü"],c:1},
  {q:"¬´das Wasser¬ª ‚Äî",o:["–≤–æ–¥–∞","–º–æ–ª–æ–∫–æ","–∫–æ—Ñ–µ","—Ö–ª–µ–±"],c:0},
  {q:"–ü–µ—Ä–µ–≤–æ–¥ ¬´wei√ü¬ª",o:["—á—ë—Ä–Ω—ã–π","–∑–µ–ª—ë–Ω—ã–π","–±–µ–ª—ã–π","–∂—ë–ª—Ç—ã–π"],c:2},
  {q:"¬´heute¬ª ‚Äî",o:["–∑–∞–≤—Ç—Ä–∞","–≤—á–µ—Ä–∞","—Å–µ–≥–æ–¥–Ω—è","—Å–µ–π—á–∞—Å"],c:2},
  {q:"¬´die Wohnung¬ª ‚Äî",o:["–∫–≤–∞—Ä—Ç–∏—Ä–∞","–∫—É—Ö–Ω—è","–≤–∞–Ω–Ω–∞—è","–¥–æ–º"],c:0},
  {q:"¬´Gute Nacht¬ª ‚Äî",o:["–°–ø–æ–∫–æ–π–Ω–æ–π –Ω–æ—á–∏","–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä","–î–æ–±—Ä—ã–π –¥–µ–Ω—å","–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ"],c:0},
  {q:"–ö–∞–∫ —Å–ø—Ä–æ—Å–∏—Ç—å —Ü–µ–Ω—É?",o:["Wie viel kostet das?","Wie sp√§t ist es?","Wie lange?","Wie viele?"],c:0},
  {q:"¬´–Ø —Ö–æ—á—É –∫–æ—Ñ–µ¬ª",o:["Ich habe Kaffee","Ich m√∂chte Kaffee","Ich bin Kaffee","Ich mache Kaffee"],c:1},
  {q:"–ê—Ä—Ç–∏–∫–ª—å —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–æ–¥–∞",o:["der","die","das","den"],c:2},
  {q:"V2-–ø–æ–∑–∏—Ü–∏—è –æ–∑–Ω–∞—á–∞–µ—Ç‚Ä¶",o:["–ì–ª–∞–≥–æ–ª –Ω–∞ 2-–º –º–µ—Å—Ç–µ","–ì–ª–∞–≥–æ–ª –≤ –∫–æ–Ω—Ü–µ","–ì–ª–∞–≥–æ–ª –ø—Ä–æ–ø–∞–¥–∞–µ—Ç","–ù–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è"],c:0},
  {q:"¬´—è –µ—Å—Ç—å/—è–≤–ª—è—é—Å—å¬ª",o:["ich habe","ich bin","ich seid","ich bist"],c:1},
  {q:"¬´—É –Ω–∞—Å –µ—Å—Ç—å¬ª",o:["wir sind","wir habt","wir haben","wir hat"],c:2},
  {q:"¬´–º–µ—Ç—Ä–æ¬ª",o:["die U-Bahn","die Stra√üe","der Bahnhof","der Flughafen"],c:0},
  {q:"¬´–∞–ø—Ç–µ–∫–∞¬ª",o:["die Apotheke","der Arzt","die Rechnung","der Markt"],c:0},
  {q:"¬´–ø—Ä–∏–º–µ—Ä–æ—á–Ω–∞—è¬ª",o:["die Gr√∂√üe","die Kasse","die Umkleidekabine","der Preis"],c:2},
  {q:"¬´—Å–µ–≥–æ–¥–Ω—è —Ö–æ–ª–æ–¥–Ω–æ¬ª",o:["Heute ist es kalt","Heute kalt ist","Es kalt heute","Heute ist kalt"],c:0},
  {q:"–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–∞—Ä–∞: sein?",o:["du sind","wir seid","ihr sind","ihr seid"],c:3},
  {q:"–ú–æ–¥–∞–ª—å–Ω—ã–µ: ¬´–Ø –º–æ–≥—É –≥–æ–≤–æ—Ä–∏—Ç—å –ø–æ-–Ω–µ–º–µ—Ü–∫–∏¬ª",o:["Ich kann Deutsch sprechen","Ich spreche kann Deutsch","Ich kann sprechen Deutsch","Ich Deutsch kann sprechen"],c:0},
  {q:"¬´–Ω–∞–ª–∏—á–Ω—ã–º–∏¬ª",o:["mit Karte","bar","teuer","billig"],c:1},
  {q:"¬´–≤–æ–∫–∑–∞–ª¬ª",o:["der Bahnhof","der Park","das Zentrum","die Schule"],c:0},
  {q:"¬´—É–ª–∏—Ü–∞¬ª",o:["die Stra√üe","die Stadt","der Weg","der Platz"],c:0},
  {q:"¬´–≥–¥–µ ‚Ä¶?¬ª",o:["Wer ist ‚Ä¶?","Wo ist ‚Ä¶?","Was ist ‚Ä¶?","Wie ist ‚Ä¶?"],c:1},
  {q:"¬´–•–æ—Ä–æ—à–æ, —Å–ø–∞—Å–∏–±–æ¬ª",o:["Gut, danke","Danke gut","Guten Dank","Gut und danke"],c:0},
  {q:"¬´–°—á—ë—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞¬ª",o:["Die Gr√∂√üe, bitte","Die Rechnung, bitte","Der Preis, bitte","Das Ticket, bitte"],c:1},
  {q:"–ö–∞–∫ —Å–∫–∞–∑–∞—Ç—å ¬´–ò–∑–≤–∏–Ω–∏—Ç–µ¬ª",o:["Entschuldigung","Bitte","Danke","Hallo"],c:0},
  {q:"¬´–¥–≤–∞¬ª",o:["zwei","drei","vier","zehn"],c:0},
  {q:"¬´–º–∞–≥–∞–∑–∏–Ω –æ–¥–µ–∂–¥—ã¬ª (–∫–æ–Ω—Ç–µ–∫—Å—Ç)",o:["Jacke","Gr√∂√üe","Umkleidekabine","Preis"],c:2},
  {q:"¬´–≤–æ–¥–∞¬ª",o:["Milch","Wasser","Tee","Kaffee"],c:1},
  {q:"¬´–º–æ–π –¥–æ–º¬ª (—Ä–æ–¥)",o:["die Haus","der Haus","das Haus","den Haus"],c:2},
  {q:"–í–æ–ø—Ä–æ—Å –±–µ–∑ –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ–≤–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å‚Ä¶",o:["—Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–≥–æ","–≥–ª–∞–≥–æ–ª–∞","–º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è","—á–∞—Å—Ç–∏—Ü—ã"],c:1}
];

// =================== APP STATE ===================
let favorites = new Set(JSON.parse(localStorage.getItem('favorites')||'[]'));
let currentCardIndex = parseInt(localStorage.getItem('cardIndex')||'0',10);
let isFlipped = false;
let cardPool = []; // —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫

function trans(item){ return item[transLang] || item.ru || ""; }
function speak(text){
  try{
    if(!('speechSynthesis' in window)) { alert('–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–∑–≤—É—á–∫—É.'); return; }
    const u = new SpeechSynthesisUtterance(text); u.lang='de-DE'; u.rate=0.95; speechSynthesis.cancel(); speechSynthesis.speak(u);
  }catch(e){ console.warn(e); }
}

// ---- –ù–∞–≤–∏–≥–∞—Ü–∏—è ----
function switchTab(name){
  document.querySelectorAll('.tab-content').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('#tabs a').forEach(a=>a.classList.remove('active'));
  document.getElementById(name)?.classList.add('active');
  document.querySelector(`#tabs a[data-tab="${name}"]`)?.classList.add('active');
  localStorage.setItem('currentTab', name);
}
function initTabs(){
  document.querySelectorAll('#tabs a').forEach(a=>{
    a.addEventListener('click',(e)=>{ e.preventDefault(); const name=a.dataset.tab; location.hash=name; switchTab(name); });
  });
  window.addEventListener('hashchange',()=>{ const h=location.hash.replace('#',''); if(document.getElementById(h)) switchTab(h); });
  const start=(location.hash || '#' + (localStorage.getItem('currentTab')||'lessons')).replace('#','');
  switchTab(start);
}

// ---- –£—Ä–æ–∫–∏ ----
function loadLessonFilter(){
  const sel=document.getElementById('lesson-filter');
  sel.innerHTML = '<option value="all">‚Äî</option>' + [...new Set(lessons.map(x=>x.topic))].map(t=>`<option>${t}</option>`).join('');
  sel.onchange = renderLessons;
}
function renderLessons(){
  const filter = document.getElementById('lesson-filter').value;
  const box = document.getElementById('lessons-list'); box.innerHTML='';
  const data = (filter==='all') ? lessons : lessons.filter(x=>x.topic===filter);
  document.getElementById('lesson-count').textContent = data.length + ' ' + (uiLang==='az'?'d…ôrs':uiLang==='de'?'Lektion(en)':'—É—Ä–æ–∫(–æ–≤)');
  data.forEach(lesson=>{
    const el=document.createElement('div'); el.className='card';
    el.innerHTML = `
      <h3>${lesson.title} <span class="badge">${lesson.topic}</span></h3>
      <div style="margin:6px 0 8px;color:#93c5fd;font-weight:700">–§—Ä–∞–∑—ã</div>
      ${lesson.phrases.map(p=>`
        <div class="row" style="justify-content:space-between;border:1px solid var(--border);border-radius:12px;padding:8px;margin:6px 0;background:#0b1222">
          <div><strong>${p.de}</strong><div class="muted">${p[transLang]||p.ru}</div></div>
          <button class="ghost say">üîä</button>
        </div>
      `).join('')}
      <div style="margin:10px 0 6px;color:#93c5fd;font-weight:700">–ú–∏–Ω–∏-–¥–∏–∞–ª–æ–≥</div>
      <div class="row" style="flex-direction:column;align-items:stretch">
        ${lesson.dialog.map(d=>`<div class="dlg-bubble dlg-de"><div><strong>${d.de}</strong><div class="dlg-ru">${d[transLang]||d.ru}</div></div></div>`).join('')}
      </div>`;
    box.appendChild(el);
    el.querySelectorAll('.say').forEach((b,i)=>b.addEventListener('click',()=>speak(lesson.phrases[i].de)));
  });
}

// ---- –°–ª–æ–≤–∞—Ä—å ----
function fillTopicSelect(){
  const topicSel=document.getElementById('topic');
  topicSel.innerHTML = '<option value="all">‚Äî</option>' + TOPICS.map(t=>`<option>${t}</option>`).join('');
  const cardsSel=document.getElementById('cards-topic');
  cardsSel.innerHTML = '<option value="all">‚Äî</option>' + TOPICS.map(t=>`<option>${t}</option>`).join('');
  cardsSel.onchange = refreshCardPool;
}
function renderDict(){
  const q=document.getElementById('q').value.trim().toLowerCase();
  const topic=document.getElementById('topic').value;
  const onlyFav = document.getElementById('onlyFav').dataset.on === '1';
  const box=document.getElementById('dict'); box.innerHTML='';
  vocabulary
    .filter(w => (topic==='all'||w.t===topic))
    .filter(w => !q || w.de.toLowerCase().includes(q) || w.ru.toLowerCase().includes(q) || (w.az||'').toLowerCase().includes(q))
    .filter(w => !onlyFav || favorites.has(w.de))
    .forEach(w=>{
      const div=document.createElement('div'); div.className='item card';
      const fav = favorites.has(w.de) ? 'style="color:#fbbf24;border-color:#fbbf24"' : '';
      div.innerHTML = `
        <div>
          <strong>${w.de}</strong>
          <div class="muted">‚Äî ${trans(w)} ${w.ipa?`<span class="muted">/${w.ipa}/</span>`:''}</div>
          <div class="badge">${w.t}</div>
        </div>
        <div class="row">
          <button class="ghost say">üîä</button>
          <button class="ghost fav" ${fav}>‚òÖ</button>
        </div>`;
      div.querySelector('.say').addEventListener('click',()=>speak(w.de));
      const favBtn = div.querySelector('.fav');
      favBtn.addEventListener('click',()=>{
        if(favorites.has(w.de)){ favorites.delete(w.de); favBtn.removeAttribute('style'); }
        else { favorites.add(w.de); favBtn.style.color='#fbbf24'; favBtn.style.borderColor='#fbbf24'; }
        localStorage.setItem('favorites', JSON.stringify([...favorites]));
      });
      box.appendChild(div);
    });
}
// –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç
function exportProgress(){
  const data = { favorites:[...favorites], cardIndex: currentCardIndex, uiLang, transLang };
  const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'deutsch_progress.json';
  document.body.appendChild(a); a.click(); a.remove();
}
function importProgress(file){
  const reader = new FileReader();
  reader.onload = ()=>{
    try{
      const data = JSON.parse(reader.result);
      favorites = new Set(data.favorites||[]);
      currentCardIndex = parseInt(data.cardIndex||0,10);
      uiLang = data.uiLang || uiLang;
      transLang = data.transLang || transLang;
      localStorage.setItem('favorites', JSON.stringify([...favorites]));
      localStorage.setItem('cardIndex', String(currentCardIndex));
      localStorage.setItem('uiLang', uiLang);
      localStorage.setItem('transLang', transLang);
      document.getElementById('ui-lang').value = uiLang;
      document.getElementById('trans-lang').value = transLang;
      applyUI(); renderDict(); refreshCardPool(); showCard();
      alert('–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω ‚úÖ');
    }catch(e){ alert('–§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥—ë–Ω'); }
  };
  reader.readAsText(file);
}

// ---- –¢–µ—Å—Ç ----
let qi=0, score=0;
function initQuiz(){ qi=0; score=0; drawQ(); }
function drawQ(){
  const qn=document.getElementById('question');
  const opts=document.getElementById('options');
  const bar=document.getElementById('bar');
  const ptxt=document.getElementById('progText');
  const fin=document.getElementById('final');
  fin.style.display='none'; document.getElementById('again').onclick=initQuiz;
  if(qi>=quiz.length){
    qn.textContent=''; opts.innerHTML='';
    fin.style.display='block';
    const L=UI[uiLang]; document.getElementById('scoreText').textContent=(uiLang==='de'?'Ergebnis: ':'–†–µ–∑—É–ª—å—Ç–∞—Ç: ') + `${score} / ${quiz.length}`;
    bar.style.width='100%'; ptxt.textContent=`${quiz.length} / ${quiz.length}`;
    return;
  }
  const item=quiz[qi];
  qn.textContent=item.q; opts.innerHTML='';
  item.o.forEach((text,i)=>{
    const el=document.createElement('div'); el.className='opt'; el.tabIndex=0; el.textContent=text;
    el.addEventListener('click',()=>pick(i));
    el.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' ') pick(i); });
    opts.appendChild(el);
  });
  const progress=Math.round(100*qi/quiz.length);
  bar.style.width=progress+'%'; ptxt.textContent=`${qi} / ${quiz.length}`;
  function pick(i){
    document.querySelectorAll('.opt').forEach((el,idx)=>{
      el.classList.add('dis');
      if(idx===item.c) el.classList.add('correct');
      if(idx===i && idx!==item.c) el.classList.add('wrong');
    });
    if(i===item.c) score++;
    setTimeout(()=>{ qi++; drawQ(); }, 700);
  }
}

// ---- –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ ----
function loadGrammar(){
  const box=document.getElementById('grammar-list'); box.innerHTML='';
  grammar.forEach(section=>{
    const el=document.createElement('div'); el.className='card';
    el.innerHTML = `
      <h3>${section.title}</h3>
      <ul>${section.points.map(p=>`<li class="muted" style="margin:6px 0">${p}</li>`).join('')}</ul>
      ${section.examples? `<div style="margin-top:10px;color:#93c5fd;font-weight:700">–ü—Ä–∏–º–µ—Ä—ã</div>
      ${section.examples.map(ex=>`<div class="row" style="justify-content:space-between;border:1px solid var(--border);border-radius:12px;padding:8px;margin:6px 0;background:#0b1222">
        <div><strong>${ex.de}</strong><div class="muted">${ex[transLang]||ex.ru}</div></div>
        <button class="ghost say">üîä</button>
      </div>`).join('')}`:''}
    `;
    box.appendChild(el);
    el.querySelectorAll('.say').forEach((b,i)=>{
      const ex = section.examples && section.examples[i]; if(ex) b.addEventListener('click',()=>speak(ex.de));
    });
  });
}

// ---- –ö–∞—Ä—Ç–æ—á–∫–∏ (fixed) ----
function refreshCardPool(){
  const topic = document.getElementById('cards-topic').value;
  const onlyFav = document.getElementById('cards-only-fav').dataset.on === '1';
  cardPool = vocabulary.filter(w => (topic==='all'||w.t===topic)).filter(w => !onlyFav || favorites.has(w.de));
  if(cardPool.length===0){ cardPool = vocabulary.slice(); }
  if(currentCardIndex>=cardPool.length) currentCardIndex=0;
  showCard();
}
function showCard(){
  const item = cardPool[currentCardIndex] || vocabulary[0];
  // front: DE, back: translation (RU/AZ)
  document.getElementById('frontText').textContent=item.de;
  document.getElementById('backText').textContent=`${trans(item)}${item.ipa? ' /'+item.ipa+'/' : ''}`;
  document.getElementById('counter').textContent=`${(cardPool.length?currentCardIndex:0)+1} / ${cardPool.length||1}`;
}
function initCards(){
  refreshCardPool();
  document.getElementById('flipBtn').onclick=()=>{ isFlipped=!isFlipped; document.getElementById('flip').classList.toggle('flipped', isFlipped); };
  document.getElementById('flip').onclick=()=>{ isFlipped=!isFlipped; document.getElementById('flip').classList.toggle('flipped', isFlipped); };
  document.getElementById('next').onclick=()=>{ isFlipped=false; document.getElementById('flip').classList.remove('flipped'); currentCardIndex=(currentCardIndex+1)%cardPool.length; localStorage.setItem('cardIndex', String(currentCardIndex)); showCard(); };
  document.getElementById('prev').onclick=()=>{ isFlipped=false; document.getElementById('flip').classList.remove('flipped'); currentCardIndex=(currentCardIndex-1+cardPool.length)%cardPool.length; localStorage.setItem('cardIndex', String(currentCardIndex)); showCard(); };
  document.getElementById('say').onclick=()=>{ const item = cardPool[currentCardIndex]; speak(item.de); };
}

// ---- –î–∏–∞–ª–æ–≥–∏ ----
function loadDialogs(){
  const sel=document.getElementById('dlg-topic');
  sel.innerHTML = Object.keys(dialogs).map(t=>`<option>${t}</option>`).join('');
  const render=()=>{
    const box=document.getElementById('dlg-box'); box.innerHTML='';
    const t = sel.value;
    dialogs[t].forEach(rep=>{
      const b=document.createElement('div'); b.className='dlg-bubble dlg-de';
      b.innerHTML=`<div><strong>${rep.de}</strong><div class="dlg-ru">${rep[transLang]||rep.ru}</div></div>`;
      box.appendChild(b);
    });
  };
  sel.onchange=render; render();
  document.getElementById('playdlg').onclick=()=>{
    const t=sel.value; let seq=''; dialogs[t].forEach(r=>{ seq += r.de + '. '; }); speak(seq);
  };
}

// ---- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ----
document.addEventListener('DOMContentLoaded', ()=>{
  if(!location.hash){ location.hash = '#lessons'; }
  document.getElementById('ui-lang').value = uiLang;
  document.getElementById('trans-lang').value = transLang;
  document.getElementById('ui-lang').addEventListener('change',(e)=>{ uiLang = e.target.value; localStorage.setItem('uiLang', uiLang); applyUI(); renderLessons(); renderDict(); loadGrammar(); });
  document.getElementById('trans-lang').addEventListener('change',(e)=>{ transLang = e.target.value; localStorage.setItem('transLang', transLang); renderLessons(); renderDict(); loadGrammar(); refreshCardPool(); showCard(); });
  applyUI();

  initTabs();
  loadLessonFilter(); renderLessons();

  fillTopicSelect(); renderDict();
  document.getElementById('q').addEventListener('input', renderDict);
  document.getElementById('topic').addEventListener('change', renderDict);
  document.getElementById('onlyFav').addEventListener('click', (e)=>{ const on = e.target.dataset.on==='1' ? '0' : '1'; e.target.dataset.on=on; applyUI(); renderDict(); refreshCardPool(); });
  document.getElementById('exportBtn').addEventListener('click', exportProgress);
  document.getElementById('importFile').addEventListener('change', (e)=>{ if(e.target.files[0]) importProgress(e.target.files[0]); });

  document.getElementById('again').addEventListener('click', initQuiz); initQuiz();

  loadGrammar();

  document.getElementById('cards-only-fav').addEventListener('click', (e)=>{ const on = e.target.dataset.on==='1' ? '0' : '1'; e.target.dataset.on=on; applyUI(); refreshCardPool(); });
  initCards();

  loadDialogs();
});
</script>
</body>
</html>
