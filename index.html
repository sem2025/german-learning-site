<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title data-i18n="app_title">Deutsch Lernen</title>
<meta name="theme-color" content="#0ea5e9"/>

<style>
:root{
  --primary:#0ea5e9; --primary-dark:#0284c7;
  --bg:#0b1020; --surface:#0f172a; --card:#0b1225;
  --text:#e5e7eb; --muted:#94a3b8; --accent:#22c55e;
  --danger:#ef4444; --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.25);
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:linear-gradient(135deg,#0b1222,#081020 60%,#0b1222);
  color:var(--text);
}
header{
  position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(6px);
  background:linear-gradient(135deg,#0284c7,#0ea5e9);
  padding:16px 12px 10px; box-shadow:var(--shadow);
}
.container{max-width:1100px;margin:0 auto;padding:0 12px}
.topbar{display:flex;gap:12px;align-items:center;justify-content:space-between}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:36px;height:36px;border-radius:10px;background:#fff1;border:2px solid #ffffff80;display:grid;place-items:center;color:#fff}
h1{margin:0;font-size:22px;letter-spacing:.3px}

.controls{display:flex;gap:8px;align-items:center}
select,button,input{
  background:#ffffff10;border:1px solid #ffffff22;color:var(--text);
  padding:10px 12px;border-radius:10px;font:inherit;outline:none;
}
select:focus,button:focus,input:focus{box-shadow:0 0 0 2px #fff3}
button.primary{background:#0ea5e9;border-color:#0000;color:#fff}
button.ghost{background:#ffffff12}
.badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#0006}

nav.tabs{
  margin-top:10px; display:flex; gap:8px; flex-wrap:wrap
}
nav.tabs button{
  padding:10px 14px;border-radius:999px;border:1px solid #ffffff22;background:#ffffff10;color:#fff;cursor:pointer
}
nav.tabs button.active{background:#fff;color:#0b1020;border-color:#fff}

main{padding:18px 0 60px}
.section{display:none}
.section.active{display:block}
h2{margin:0 0 14px;font-size:22px;color:#7dd3fc}

.card{
  background:linear-gradient(180deg,#0f1b37,#0b1225);
  border:1px solid #ffffff1a;border-radius:var(--radius);box-shadow:var(--shadow);
  padding:14px
}
.grid{display:grid;gap:12px}
@media (min-width:800px){ .grid.cols-2{grid-template-columns:1fr 1fr} .grid.cols-3{grid-template-columns:repeat(3,1fr)} }

.item{
  background:#0d1530;border:1px solid #ffffff1a;border-radius:12px;padding:12px
}
.item h4{margin:0 0 6px}
.small{font-size:13px;color:var(--muted)}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.space{height:10px}
hr.sep{border:none;border-top:1px solid #ffffff14;margin:14px 0}
kbd{background:#0004;padding:2px 6px;border-radius:6px;border:1px solid #ffffff22}

/* Cards (flashcards) */
#cardWrap{perspective:1000px}
.card3d{
  width:100%;min-height:140px;max-width:520px;margin:8px auto;
  position:relative;transform-style:preserve-3d;transition:transform .6s;cursor:pointer
}
.face{
  position:absolute;inset:0;display:grid;place-items:center;text-align:center;
  padding:18px;border-radius:14px;background:#0f1b37;border:1px solid #ffffff20
}
.back{transform:rotateY(180deg)}
.card3d.flipped{transform:rotateY(180deg)}
.controlsRow{display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap}

/* Table-ish list */
.list li{display:flex;justify-content:space-between;gap:10px;padding:10px;border-bottom:1px solid #ffffff14}
.list .g{color:#93c5fd}
audio{width:100%}
footer{position:fixed;bottom:6px;left:0;right:0;text-align:center;color:#94a3b8;font-size:12px}
</style>
</head>
<body>
<header>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <div class="logo">DE</div>
        <div>
          <div class="row" style="gap:6px;">
            <h1 data-i18n="app_title">Deutsch Lernen</h1>
            <span class="badge" id="buildInfo">Tri-lingual UI</span>
          </div>
          <div class="small" data-i18n="subtitle">Учебное мини-приложение в одном файле</div>
        </div>
      </div>
      <div class="controls">
        <label class="small" for="uiLang" data-i18n="label_ui_lang">Язык интерфейса</label>
        <select id="uiLang" aria-label="UI language">
          <option value="ru">Русский</option>
          <option value="de">Deutsch</option>
          <option value="az">Azərbaycanca</option>
        </select>
        <button id="installBtn" class="ghost" data-i18n="btn_install">Установить</button>
      </div>
    </div>

    <nav class="tabs container" id="tabs">
      <button data-tab="lessons" class="active" data-i18n="tab_lessons">Уроки</button>
      <button data-tab="dictionary" data-i18n="tab_dictionary">Словарь</button>
      <button data-tab="test" data-i18n="tab_test">Тест</button>
      <button data-tab="grammar" data-i18n="tab_grammar">Грамматика</button>
      <button data-tab="cards" data-i18n="tab_cards">Карточки</button>
      <button data-tab="dialogs" data-i18n="tab_dialogs">Диалоги</button>
    </nav>
  </div>
</header>

<main class="container">
  <!-- LESSONS -->
  <section id="lessons" class="section active">
    <h2 data-i18n="section_lessons">Уроки</h2>
    <div class="grid cols-2">
      <div class="card">
        <div class="row" style="justify-content:space-between;">
          <h3 data-i18n="lesson_greetings">Приветствия и знакомство</h3>
          <span class="small" id="lessonsCount"></span>
        </div>
        <div id="lessonsList" class="grid"></div>
      </div>
      <div class="card">
        <h3 data-i18n="lesson_numbers">Числа 1–10</h3>
        <ul class="list" id="numbersList"></ul>
      </div>
    </div>
  </section>

  <!-- DICTIONARY -->
  <section id="dictionary" class="section">
    <h2 data-i18n="section_dictionary">Словарь</h2>
    <div class="card">
      <div class="row" style="justify-content:space-between;gap:10px">
        <input id="dictSearch" placeholder="Suche / Поиск / Axtarış…" />
        <button id="onlyFav" class="ghost" data-i18n="btn_favorites">Избранное</button>
      </div>
      <ul class="list" id="dictList"></ul>
    </div>
  </section>

  <!-- TEST -->
  <section id="test" class="section">
    <h2 data-i18n="section_test">Тест</h2>
    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <div class="small" id="progressText">0/0</div>
        <div class="small" data-i18n="hint_test">Выберите правильный перевод</div>
      </div>
      <div class="space"></div>
      <div id="qBox" class="item"></div>
      <div class="grid" id="answers" style="margin-top:12px"></div>
      <div class="space"></div>
      <div class="row" style="justify-content:space-between;">
        <button id="restart" class="ghost" data-i18n="btn_restart">Сначала</button>
        <div class="small" id="result"></div>
      </div>
    </div>
  </section>

  <!-- GRAMMAR -->
  <section id="grammar" class="section">
    <h2 data-i18n="section_grammar">Грамматика</h2>
    <div class="grid cols-2">
      <div class="card">
        <h3 data-i18n="gram_articles">Артикли (der / die / das)</h3>
        <ul class="small">
          <li>der Mann — <span class="g">мужчина</span></li>
          <li>die Frau — <span class="g">женщина</span></li>
          <li>das Kind — <span class="g">ребёнок</span></li>
        </ul>
      </div>
      <div class="card">
        <h3 data-i18n="gram_verb_to_be">Sein (быть)</h3>
        <ul class="small">
          <li>ich <b>bin</b>, du <b>bist</b>, er/sie/es <b>ist</b></li>
          <li>wir <b>sind</b>, ihr <b>seid</b>, sie/Sie <b>sind</b></li>
        </ul>
      </div>
    </div>
  </section>

  <!-- CARDS -->
  <section id="cards" class="section">
    <h2 data-i18n="section_cards">Карточки</h2>
    <div class="card">
      <div class="row" style="gap:10px;justify-content:space-between;">
        <label class="small" for="cardsTopic" data-i18n="label_cards_topic">Тема карточек</label>
        <select id="cardsTopic">
          <option value="all" data-i18n="filter_all">Все</option>
          <option value="greet">Greetings</option>
          <option value="food">Food</option>
          <option value="family">Family</option>
        </select>
        <button id="ttsCard" class="ghost" data-i18n="btn_speak">Озвучить</button>
      </div>
      <div id="cardWrap">
        <div id="flash" class="card3d" tabindex="0" aria-live="polite">
          <div class="face front" id="front"></div>
          <div class="face back" id="back"></div>
        </div>
      </div>
      <div class="controlsRow">
        <button id="prev" class="ghost">◀</button>
        <div class="small" id="cardCounter">1/1</div>
        <button id="next" class="ghost">▶</button>
        <button id="flip" class="primary" data-i18n="btn_flip">Перевернуть</button>
      </div>
    </div>
  </section>

  <!-- DIALOGS -->
  <section id="dialogs" class="section">
    <h2 data-i18n="section_dialogs">Диалоги</h2>
    <div class="grid cols-2">
      <div class="card">
        <h3>Im Café</h3>
        <ul class="small">
          <li><b>A:</b> Guten Tag! <i>Добрый день!</i></li>
          <li><b>B:</b> Ich möchte einen Kaffee, bitte. <i>Кофе, пожалуйста.</i></li>
          <li><b>A:</b> Gerne. Noch etwas? <i>Что-нибудь ещё?</i></li>
        </ul>
      </div>
      <div class="card">
        <h3>Am Bahnhof</h3>
        <ul class="small">
          <li><b>A:</b> Wo ist der Zug nach Berlin? <i>Где поезд до Берлина?</i></li>
          <li><b>B:</b> Gleis 3. <i>Путь №3.</i></li>
        </ul>
      </div>
    </div>
  </section>
</main>

<footer class="container">
  <span class="small">© Deutsch Lernen — single-file app</span>
</footer>

<script>
/* ------------------------ DATA ------------------------ */
const lessons = [
  { titleKey:"lesson_greetings", items:[
    { de:"Hallo! Wie heißen Sie?", tr:"Здравствуйте! Как вас зовут?" },
    { de:"Ich heiße Sanz. Freut mich!", tr:"Меня зовут Санз. Приятно познакомиться!" },
    { de:"Wie geht's?", tr:"Как дела?" },
  ]},
];

const numbers = [
  ["eins","один"],["zwei","два"],["drei","три"],["vier","четыре"],["fünf","пять"],
  ["sechs","шесть"],["sieben","семь"],["acht","восемь"],["neun","девять"],["zehn","десять"],
];

const vocabulary = [
  {g:"Hallo", r:"Привет", topic:"greet"},
  {g:"Danke", r:"Спасибо", topic:"greet"},
  {g:"Bitte", r:"Пожалуйста", topic:"greet"},
  {g:"Wasser", r:"Вода", topic:"food"},
  {g:"Brot", r:"Хлеб", topic:"food"},
  {g:"der Vater", r:"Отец", topic:"family"},
  {g:"die Mutter", r:"Мать", topic:"family"},
];

const cards = [
  {front:"Hallo!", back:"Привет!", topic:"greet"},
  {front:"Wie geht's?", back:"Как дела?", topic:"greet"},
  {front:"Brot", back:"Хлеб", topic:"food"},
  {front:"Wasser", back:"Вода", topic:"food"},
  {front:"der Vater", back:"Отец", topic:"family"},
  {front:"die Mutter", back:"Мать", topic:"family"},
];

const quiz = [
  {q:"Hallo", a:["Спасибо","Привет","Пожалуйста"], right:1},
  {q:"Brot", a:["Хлеб","Вода","Сок"], right:0},
  {q:"Mutter", a:["Мать","Отец","Сестра"], right:0},
];

/* ------------------ I18N (UI ONLY) ------------------ */
const I18N = {
  ru:{ app_title:"Deutsch Lernen",
    subtitle:"Учебное мини-приложение в одном файле",
    label_ui_lang:"Язык интерфейса",
    btn_install:"Установить",
    tab_lessons:"Уроки", tab_dictionary:"Словарь", tab_test:"Тест", tab_grammar:"Грамматика", tab_cards:"Карточки", tab_dialogs:"Диалоги",
    section_lessons:"Уроки", section_dictionary:"Словарь", section_test:"Тест", section_grammar:"Грамматика", section_cards:"Карточки", section_dialogs:"Диалоги",
    lesson_greetings:"Приветствия и знакомство", lesson_numbers:"Числа 1–10",
    gram_articles:"Артикли (der / die / das)", gram_verb_to_be:"Sein (быть)",
    label_cards_topic:"Тема карточек", filter_all:"Все",
    btn_favorites:"Избранное", btn_speak:"Озвучить", btn_flip:"Перевернуть", btn_restart:"Сначала",
    hint_test:"Выберите правильный перевод"
  },
  de:{ app_title:"Deutsch Lernen",
    subtitle:"Lern-Mini-App in einer Datei",
    label_ui_lang:"UI-Sprache",
    btn_install:"Installieren",
    tab_lessons:"Lektionen", tab_dictionary:"Wörterbuch", tab_test:"Test", tab_grammar:"Grammatik", tab_cards:"Karten", tab_dialogs:"Dialoge",
    section_lessons:"Lektionen", section_dictionary:"Wörterbuch", section_test:"Test", section_grammar:"Grammatik", section_cards:"Karten", section_dialogs:"Dialoge",
    lesson_greetings:"Begrüßung & Kennenlernen", lesson_numbers:"Zahlen 1–10",
    gram_articles:"Artikel (der / die / das)", gram_verb_to_be:"Sein (sein)",
    label_cards_topic:"Kartenthema", filter_all:"Alle",
    btn_favorites:"Favoriten", btn_speak:"Vorlesen", btn_flip:"Umdrehen", btn_restart:"Neu starten",
    hint_test:"Wählen Sie die richtige Übersetzung"
  },
  az:{ app_title:"Almanca Öyrən",
    subtitle:"Bir faylda öyrənmə mini-tətbiqi",
    label_ui_lang:"İnterfeys dili",
    btn_install:"Quraşdır",
    tab_lessons:"Dərslər", tab_dictionary:"Lüğət", tab_test:"Test", tab_grammar:"Qrammatika", tab_cards:"Kartlar", tab_dialogs:"Dialoqlar",
    section_lessons:"Dərslər", section_dictionary:"Lüğət", section_test:"Test", section_grammar:"Qrammatika", section_cards:"Kartlar", section_dialogs:"Dialoqlar",
    lesson_greetings:"Salamlaşma və tanışlıq", lesson_numbers:"Rəqəmlər 1–10",
    gram_articles:"Məqalələr (der / die / das)", gram_verb_to_be:"Sein (olmaq)",
    label_cards_topic:"Kart mövzusu", filter_all:"Hamısı",
    btn_favorites:"Seçilmişlər", btn_speak:"Səsləndir", btn_flip:"Çevir", btn_restart:"Yenidən",
    hint_test:"Düzgün tərcüməni seçin"
  }
};

function applyI18n(lang){
  const dict = I18N[lang] || I18N.ru;
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const k = el.getAttribute("data-i18n");
    if (dict[k]) el.textContent = dict[k];
  });
  localStorage.setItem("uiLang", lang);
  document.documentElement.lang = lang;
}

(function initI18n(){
  const sel = document.getElementById("uiLang");
  const saved = localStorage.getItem("uiLang") || (["ru","de","az"].includes(navigator.language.slice(0,2))?navigator.language.slice(0,2):"ru");
  sel.value = saved; applyI18n(saved);
  sel.addEventListener("change", e=>applyI18n(e.target.value));
})();

/* ------------------ NAV / TABS ------------------ */
document.getElementById("tabs").addEventListener("click", e=>{
  const btn = e.target.closest("button[data-tab]"); if(!btn) return;
  document.querySelectorAll("nav.tabs button").forEach(b=>b.classList.toggle("active", b===btn));
  const id = btn.dataset.tab;
  document.querySelectorAll(".section").forEach(s=>s.classList.toggle("active", s.id===id));
  window.scrollTo({top:0,behavior:"smooth"});
});

/* ------------------ LESSONS RENDER ------------------ */
const lessonsList = document.getElementById("lessonsList");
lessons.forEach(lesson=>{
  const box = document.createElement("div"); box.className="item";
  const h = document.createElement("h4"); h.setAttribute("data-i18n", lesson.titleKey); h.textContent=""; // заполнит i18n
  const ul = document.createElement("ul"); ul.className="small";
  lesson.items.forEach(p=>{
    const li = document.createElement("li");
    li.innerHTML = `<b>${p.de}</b> — <i>${p.tr}</i>`;
    ul.appendChild(li);
  });
  box.append(h,ul); lessonsList.appendChild(box);
});
document.getElementById("lessonsCount").textContent = lessons.length + " ";

/* Numbers */
const numbersList = document.getElementById("numbersList");
numbers.forEach(([de,ru])=>{
  const li = document.createElement("li");
  li.innerHTML = `<span class="g">${de}</span><span>${ru}</span>`;
  numbersList.appendChild(li);
});

/* ------------------ DICTIONARY ------------------ */
const favKey = "favWords";
const fav = new Set(JSON.parse(localStorage.getItem(favKey)||"[]"));
function saveFav(){ localStorage.setItem(favKey, JSON.stringify([...fav])); }

function renderDict(filter=""){
  const onlyFav = document.getElementById("onlyFav").classList.contains("active");
  const list = document.getElementById("dictList"); list.innerHTML="";
  vocabulary
    .filter(w=> (w.g.toLowerCase().includes(filter)||w.r.toLowerCase().includes(filter)))
    .filter(w=> !onlyFav || fav.has(w.g))
    .forEach(w=>{
      const li = document.createElement("li");
      li.innerHTML = `<span><b class="g">${w.g}</b> — ${w.r}</span>`;
      const btn = document.createElement("button");
      btn.className="ghost"; btn.textContent = fav.has(w.g) ? "★" : "☆";
      btn.title="Favorite"; btn.onclick=()=>{ fav.has(w.g)?fav.delete(w.g):fav.add(w.g); saveFav(); renderDict(filter); };
      li.append(btn); list.appendChild(li);
    });
}
document.getElementById("dictSearch").addEventListener("input", e=> renderDict(e.target.value.trim().toLowerCase()));
document.getElementById("onlyFav").addEventListener("click", e=>{ e.currentTarget.classList.toggle("active"); renderDict(document.getElementById("dictSearch").value.trim().toLowerCase()); });
renderDict("");

/* ------------------ QUIZ ------------------ */
let qi=0, correct=0;
const qBox = document.getElementById("qBox"), ans = document.getElementById("answers"), res=document.getElementById("result"), prog=document.getElementById("progressText");
function drawQ(){
  const q = quiz[qi]; prog.textContent = (qi+1)+"/"+quiz.length; res.textContent="";
  qBox.innerHTML = `<b>${q.q}</b>`;
  ans.innerHTML=""; q.a.forEach((opt,i)=>{
    const b=document.createElement("button");
    b.className="item"; b.style.textAlign="left"; b.textContent=opt;
    b.onclick=()=>{
      if(i===q.right){ b.style.borderColor="#22c55e"; correct++; }
      else{ b.style.borderColor="#ef4444"; }
      setTimeout(()=>{ if(++qi<quiz.length) drawQ(); else showScore(); }, 350);
    };
    ans.appendChild(b);
  });
}
function showScore(){ qBox.innerHTML=""; ans.innerHTML=""; res.textContent="✓ "+correct+" / "+quiz.length; }
document.getElementById("restart").onclick=()=>{ qi=0; correct=0; drawQ(); };
drawQ();

/* ------------------ CARDS ------------------ */
let idx=0, stack=[...cards];
const flash=document.getElementById("flash"), front=document.getElementById("front"), back=document.getElementById("back"), counter=document.getElementById("cardCounter");
function setCard(i){
  const c = stack[i]; if(!c) return;
  front.textContent = c.front; back.textContent = c.back;
  counter.textContent = (i+1)+"/"+stack.length; flash.classList.remove("flipped");
}
function filterCards(topic){
  stack = topic==="all"? [...cards] : cards.filter(c=>c.topic===topic);
  idx=0; setCard(idx);
}
document.getElementById("cardsTopic").addEventListener("change", e=> filterCards(e.target.value));
document.getElementById("flip").onclick=()=> flash.classList.toggle("flipped");
document.getElementById("prev").onclick=()=>{ idx=(idx-1+stack.length)%stack.length; setCard(idx); };
document.getElementById("next").onclick=()=>{ idx=(idx+1)%stack.length; setCard(idx); };
flash.addEventListener("keydown", e=>{ if(e.key===" "||e.key==="Enter"){ e.preventDefault(); flash.classList.toggle("flipped"); } });
setCard(idx);

/* TTS for card */
document.getElementById("ttsCard").onclick=()=>{
  const u = new SpeechSynthesisUtterance(front.textContent);
  u.lang = "de-DE"; try{ speechSynthesis.cancel(); speechSynthesis.speak(u); }catch(e){}
};

/* ------------------ INSTALL (PWA-lite hint) ------------------ */
let deferredPrompt=null;
window.addEventListener('beforeinstallprompt', (e)=>{
  e.preventDefault(); deferredPrompt=e; document.getElementById("installBtn").style.display="inline-block";
});
document.getElementById("installBtn").onclick=async()=>{
  if(!deferredPrompt){ alert("Add to Home Screen is not available here."); return; }
  deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null;
};
</script>
</body>
</html>
